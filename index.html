<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM Ø¹Ù‚Ø§Ø±Ø§Øª</title>
<style>
*{box-sizing:border-box;}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f6f7fb;direction:rtl;}
.wrap{max-width:1200px;margin:0 auto;padding:16px;}
.card{background:#fff;border:1px solid #eee;border-radius:14px;padding:16px;box-shadow:0 4px 10px rgba(0,0,0,0.04);}
.row{display:flex;gap:12px;}
.row.col{flex-direction:column;}
.grid{display:grid;gap:12px;}
.grid2{grid-template-columns:1fr 1fr;}
.grid3{grid-template-columns:repeat(3,1fr);}
@media(max-width:800px){.grid2,.grid3{grid-template-columns:1fr;}}
.btn{border:1px solid #ddd;background:#0ea5e9;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;}
.btn.sec{background:#64748b;}
.btn.dan{background:#ef4444;}
.btn.ghost{background:#fff;color:#0f172a;border-color:#cbd5e1;}
.field{width:100%;border:1px solid #cbd5e1;border-radius:10px;padding:10px 12px;}
.tag{display:inline-block;background:#f1f5f9;color:#0f172a;border:1px solid #e2e8f0;border-radius:999px;padding:4px 10px;font-size:12px;}
.muted{color:#475569;font-size:13px;}
.table{width:100%;border-collapse:collapse;}
.table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:right;}
.tabs{display:flex;gap:8px;flex-wrap:wrap;}
.tab{padding:10px 12px;border-radius:10px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:600;}
.tab.active{background:#0ea5e9;color:#fff;border-color:#0ea5e9;}
.stat{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:12px;text-align:center;}
.stat .num{font-size:22px;font-weight:800;}
header.top{position:sticky;top:0;background:#ffffffd9;backdrop-filter:saturate(180%) blur(6px);border-bottom:1px solid #e2e8f0;z-index:10;}
.funnel{display:flex;gap:10px;flex-wrap:wrap;}
.funnel .stage{flex:1;background:#e0f2fe;padding:12px;border-radius:12px;text-align:center;}
.funnel .stage.completed{background:#a7f3d0;}
.funnel .stage.in-progress{background:#fde68a;}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script type="text/babel">

// === Ø­Ø³Ø§Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø© ===
const users = [
  {id:1,username:\'admin\',password:\'12345\',role:\'admin\',name:\'Ø§Ù„Ù…Ø¯ÙŠØ±\'},
  {id:2,username:\'sales1\',password:\'1111\',role:\'sales\',name:\'Ù…Ù†Ø¯ÙˆØ¨ 1\'}
];

const App = () => {
  const load=(k,f=null)=>{try{const r=localStorage.getItem(k);return r?JSON.parse(r):f}catch{return f}};
  const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const [currentUser,setCurrentUser]=React.useState(()=>load(\'currentUser\',null));
  const [loginData,setLoginData]=React.useState({username:\'\',password:\'\'});
  const isLoggedIn=!!currentUser;
  const isAdmin=currentUser?.role===\'admin\';
  const myUsername=currentUser?.username;

  const [activeTab,setActiveTab]=React.useState(\'dashboard\');
  const [search,setSearch]=React.useState(\'\');

  const [clients,setClients]=React.useState(()=>load(\'clients\',[]));
  const [properties,setProperties]=React.useState(()=>load(\'properties\',[]));
  const [tasks,setTasks]=React.useState(()=>load(\'tasks\',[]));

  React.useEffect(()=>save(\'clients\',clients),[clients]);
  React.useEffect(()=>save(\'properties\',properties),[properties]);
  React.useEffect(()=>save(\'tasks\',tasks),[tasks]);
  React.useEffect(()=>save(\'currentUser\',currentUser),[currentUser]);

  const handleLogin=()=>{
    const f=users.find(u=>u.username===loginData.username && u.password===loginData.password);
    if(f){setCurrentUser(f);setActiveTab(\'dashboard\');alert(\'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„\');}
    else{alert(\'âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦\');}
  };
  const handleLogout=()=>{setCurrentUser(null);alert(\'ğŸšª ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬\');};

  const visibleClients=isAdmin?clients:clients.filter(c=>c.createdBy===myUsername);
  const visibleProperties=isAdmin?properties:properties.filter(p=>p.createdBy===myUsername);
  const visibleTasks=isAdmin?tasks:tasks.filter(t=>t.createdBy===myUsername);

  const norm=s=> (s||\'\').toString().toLowerCase();
  const s=norm(search);
  const clientsFiltered=visibleClients.filter(c=>norm(c.name).includes(s) || norm(c.phone).includes(s));
  const propertiesFiltered=visibleProperties.filter(p=>norm(p.title).includes(s) || norm(p.area).includes(s));
  const tasksFiltered=visibleTasks.filter(t=>norm(t.title).includes(s));

  // ===== Forms =====
  const [clientForm,setClientForm]=React.useState({name:\'\',phone:\'\',status:\'Ù†Ø´Ø·\',stage:\'Ø¬Ø¯ÙŠØ¯\'});
  const addClient=()=>{
    if(!clientForm.name||!clientForm.phone)return alert(\'Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†\');
    const item={id:Date.now(),...clientForm,createdBy:myUsername};
    setClients(arr=>[item,...arr]);
    setClientForm({name:\'\',phone:\'\',status:\'Ù†Ø´Ø·\',stage:\'Ø¬Ø¯ÙŠØ¯\'});
  };

  const editClient=id=>{
    const c=clients.find(x=>x.id===id);if(!c)return;if(!isAdmin&&c.createdBy!==myUsername)return alert(\'Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©\');
    const name=prompt(\'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„\',c.name)??c.name;
    const phone=prompt(\'Ø§Ù„Ù‡Ø§ØªÙ\',c.phone)??c.phone;
    const status=prompt(\'Ø§Ù„Ø­Ø§Ù„Ø©\',c.status)??c.status;
    const stage=prompt(\'Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„\',c.stage)??c.stage;
    setClients(arr=>arr.map(x=>x.id===id?{...x,name,phone,status,stage}:x));
  };
  const deleteClient=id=>{const c=clients.find(x=>x.id===id);if(!c)return;if(!isAdmin&&c.createdBy!==myUsername)return alert(\'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©\');if(!confirm(\'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ\'))return;setClients(arr=>arr.filter(x=>x.id!==id));};

  const [propertyForm,setPropertyForm]=React.useState({title:\'\',area:\'\',price:\'\',status:\'Ù…ØªØ§Ø­Ø©\'});
  const addProperty=()=>{if(!propertyForm.title||!propertyForm.price)return alert(\'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†\');const item={id:Date.now(),...propertyForm,createdBy:myUsername};setProperties(arr=>[item,...arr]);setPropertyForm({title:\'\',area:\'\',price:\'\',status:\'Ù…ØªØ§Ø­Ø©\'});};
  const editProperty=id=>{const p=properties.find(x=>x.id===id);if(!p)return;if(!isAdmin&&p.createdBy!==myUsername)return alert(\'Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©\');const title=prompt(\'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±\',p.title)??p.title;const area=prompt(\'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©\',p.area||\'\')??p.area;const price=prompt(\'Ø§Ù„Ø³Ø¹Ø±\',p.price||\'\')??p.price;const status=prompt(\'Ø§Ù„Ø­Ø§Ù„Ø©\',p.status||\'Ù…ØªØ§Ø­Ø©\')??p.status;setProperties(arr=>arr.map(x=>x.id===id?{...x,title,area,price,status}:x));};
  const deleteProperty=id=>{const p=properties.find(x=>x.id===id);if(!p)return;if(!isAdmin&&p.createdBy!==myUsername)return alert(\'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©\');if(!confirm(\'ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ\'))return;setProperties(arr=>arr.filter(x=>x.id!==id));};

  const [taskForm,setTaskForm]=React.useState({title:\'\',client:\'\',dueDate:\'\',status:\'Ù…Ø¹Ù„Ù‚Ø©\'});
  const addTask=()=>{if(!taskForm.title)return alert(\'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨\');const item={id:Date.now(),...taskForm,createdBy:myUsername};setTasks(arr=>[item,...arr]);setTaskForm({title:\'\',client:\'\',dueDate:\'\',status:\'Ù…Ø¹Ù„Ù‚Ø©\'});};
  const editTask=id=>{const t=tasks.find(x=>x.id===id);if(!t)return;if(!isAdmin&&t.createdBy!==myUsername)return alert(\'Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©\');const title=prompt(\'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©\',t.title)??t.title;const client=prompt(\'Ø§Ù„Ø¹Ù…ÙŠÙ„\',t.client||\'\')??t.client;const dueDate=prompt(\'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚\',t.dueDate||\'\')??t.dueDate;const status=prompt(\'Ø§Ù„Ø­Ø§Ù„Ø©\',t.status||\'Ù…Ø¹Ù„Ù‚Ø©\')??t.status;setTasks(arr=>arr.map(x=>x.id===id?{...x,title,client,dueDate,status}:x));};
  const deleteTask=id=>{const t=tasks.find(x=>x.id===id);if(!t)return;if(!isAdmin&&t.createdBy!==myUsername)return alert(\'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©\');if(!confirm(\'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ\'))return setTasks(arr=>arr.filter(x=>x.id!==id));};

  // ===== Dashboard Stats =====
  const myClients=visibleClients.length;
  const myProps=visibleProperties.length;
  const myTasks=visibleTasks.length;
  const soldCount=visibleProperties.filter(p=>(p.status||\'\').includes(\'ØªÙ… Ø§Ù„Ø¨ÙŠØ¹\')).length;

  // ===== Funnel Stages =====
  const stages=[\'Ø¬Ø¯ÙŠØ¯\',\'Ù…Ù‡ØªÙ…\',\'Ù…ØªØ§Ø¨Ø¹Ø©\',\'ØªÙ… Ø§Ù„Ø¨ÙŠØ¹\'];
  const funnelCounts=stages.map(stage=>visibleClients.filter(c=>c.stage===stage).length);

  if(!isLoggedIn){
    return <div className="wrap" style={{minHeight:\'100vh\',display:\'grid\',placeItems:\'center\'}}>
      <div className="card" style={{width:420,maxWidth:\'100%\'}}>
        <h2 style={{marginTop:0}}>ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div className="row col" style={{gap:10}}>
          <input className="field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value={loginData.username} onChange={e=>setLoginData({...loginData,username:e.target.value})}/>
          <input className="field" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value={loginData.password} onChange={e=>setLoginData({...loginData,password:e.target.value})}/>
          <button className="btn" onClick={handleLogin}>Ø¯Ø®ÙˆÙ„</button>
          <div className="muted">Ø­Ø³Ø§Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©:
            {users.map(u=><div key={u.id}>{u.username} / {u.password} ({u.role})</div>)}
          </div>
        </div>
      </div>
    </div>;
  }

  return <div className="wrap">
    <header className="top row" style={{justifyContent:\'space-between\',alignItems:\'center\',padding:\'8px 0\'}}>
      <h2>CRM Ø¹Ù‚Ø§Ø±Ø§Øª</h2>
      <div className="row" style={{gap:6,flexWrap:\'wrap\'}}>
        <input className="field" placeholder="Ø¨Ø­Ø«..." value={search} onChange={e=>setSearch(e.target.value)} style={{minWidth:150}}/>
        <button className={`tab ${activeTab===\'dashboard\'?\'active\':\'\'}`} onClick={()=>setActiveTab(\'dashboard\')}>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        <button className={`tab ${activeTab===\'clients\'?\'active\':\'\'}`} onClick={()=>setActiveTab(\'clients\')}>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
        <button className={`tab ${activeTab===\'properties\'?\'active\':\'\'}`} onClick={()=>setActiveTab(\'properties\')}>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
        <button className={`tab ${activeTab===\'tasks\'?\'active\':\'\'}`} onClick={()=>setActiveTab(\'tasks\')}>Ø§Ù„Ù…Ù‡Ø§Ù…</button>
        <button className="btn sec" onClick={handleLogout}>Ø®Ø±ÙˆØ¬</button>
      </div>
    </header>

    {activeTab===\'dashboard\' && <div>
      <div className="grid grid3" style={{marginTop:16, gap:16}}>
        <div className="stat"><div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div><div className="num">{myClients}</div></div>
        <div className="stat"><div>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</div><div className="num">{visibleProperties.filter(p=>(p.status||\'\')===\'Ù…ØªØ§Ø­Ø©\').length}</div></div>
        <div className="stat"><div>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙØªÙˆØ­Ø©</div><div className="num">{visibleTasks.filter(t=>(t.status||\'Ù…Ø¹Ù„Ù‚Ø©\')!==\'Ù…ÙƒØªÙ…Ù„Ø©\').length}</div></div>
        <div className="stat"><div>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div><div className="num">{soldCount}</div></div>
      </div>

      <div className="card" style={{marginTop:16}}>
        <h3>ğŸ¯ Ø³ÙŠÙ„Ø² ÙØ§Ù†Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
        <div className="funnel">
          {stages.map((stage,i)=><div key={i} className={`stage ${stage===\'ØªÙ… Ø§Ù„Ø¨ÙŠØ¹\'?\'completed\':stage===\'Ù…Ù‡ØªÙ…\'?\'in-progress\':\'\'}`}>
            {stage}: {funnelCounts[i]}
          </div>)}
        </div>
      </div>
    </div>}

    {activeTab===\'clients\' && <div className="card" style={{marginTop:16}}>
      <h3>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
      <div className="row col" style={{gap:8}}>
        <input className="field" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" value={clientForm.name} onChange={e=>setClientForm({...clientForm,name:e.target.value})}/>
        <input className="field" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" value={clientForm.phone} onChange={e=>setClientForm({...clientForm,phone:e.target.value})}/>
        <select className="field" value={clientForm.stage} onChange={e=>setClientForm({...clientForm,stage:e.target.value})}>
          <option>Ø¬Ø¯ÙŠØ¯</option><option>Ù…Ù‡ØªÙ…</option><option>Ù…ØªØ§Ø¨Ø¹Ø©</option><option>ØªÙ… Ø§Ù„Ø¨ÙŠØ¹</option>
        </select>
        <button className="btn" onClick={addClient}>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
      </div>
      <table className="table">
        <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody>
          {clientsFiltered.map(c=><tr key={c.id}>
            <td>{c.name}</td><td>{c.phone}</td><td>{c.stage}</td><td>{c.status}</td>
            <td>
              <button className="btn ghost" onClick={()=>editClient(c.id)}>ØªØ¹Ø¯ÙŠÙ„</button>
              <button className="btn dan" onClick={()=>deleteClient(c.id)}>Ø­Ø°Ù</button>
            </td>
          </tr>)}
        </tbody>
      </table>
    </div>}

    {activeTab===\'properties\' && <div className="card" style={{marginTop:16}}>
      <h3>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h3>
      <div className="row col" style={{gap:8}}>
        <input className="field" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±" value={propertyForm.title} onChange={e=>setPropertyForm({...propertyForm,title:e.target.value})}/>
        <input className="field" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø©" value={propertyForm.area} onChange={e=>setPropertyForm({...propertyForm,area:e.target.value})}/>
        <input className="field" placeholder="Ø§Ù„Ø³Ø¹Ø±" value={propertyForm.price} onChange={e=>setPropertyForm({...propertyForm,price:e.target.value})}/>
        <button className="btn" onClick={addProperty}>Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±</button>
      </div>
      <table className="table">
        <thead><tr><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody>
          {propertiesFiltered.map(p=><tr key={p.id}>
            <td>{p.title}</td><td>{p.area}</td><td>{p.price}</td><td>{p.status}</td>
            <td>
              <button className="btn ghost" onClick={()=>editProperty(p.id)}>ØªØ¹Ø¯ÙŠÙ„</button>
              <button className="btn dan" onClick={()=>deleteProperty(p.id)}>Ø­Ø°Ù</button>
            </td>
          </tr>)}
        </tbody>
      </table>
    </div>}

    {activeTab===\'tasks\' && <div className="card" style={{marginTop:16}}>
      <h3>Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
      <div className="row col" style={{gap:8}}>
        <input className="field" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©" value={taskForm.title} onChange={e=>setTaskForm({...taskForm,title:e.target.value})}/>
        <input className="field" placeholder="Ø§Ù„Ø¹Ù…ÙŠÙ„" value={taskForm.client} onChange={e=>setTaskForm({...taskForm,client:e.target.value})}/>
        <input className="field" type="date" value={taskForm.dueDate} onChange={e=>setTaskForm({...taskForm,dueDate:e.target.value})}/>
        <select className="field" value={taskForm.status} onChange={e=>setTaskForm({...taskForm,status:e.target.value})}>
          <option>Ù…Ø¹Ù„Ù‚Ø©</option><option>Ù…ÙƒØªÙ…Ù„Ø©</option>
        </select>
        <button className="btn" onClick={addTask}>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
      </div>
      <table className="table">
        <thead><tr><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody>
          {tasksFiltered.map(t=><tr key={t.id}>
            <td>{t.title}</td><td>{t.client}</td><td>{t.dueDate}</td><td>{t.status}</td>
            <td>
              <button className="btn ghost" onClick={()=>editTask(t.id)}>ØªØ¹Ø¯ÙŠÙ„</button>
              <button className="btn dan" onClick={()=>deleteTask(t.id)}>Ø­Ø°Ù</button>
            </td>
          </tr>)}
        </tbody>
      </table>
    </div>}

  </div>;
};

ReactDOM.render(<App />,document.getElementById("root"));

</script>
</body>
</html>

